<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script src="dir.js"></script>
    <style>
div {
    border: 1px white solid;
    cursor: default;
}
a {
    text-decoration: none;
    color: black;
}

.dir{
}
.dir:before {
    content: " ";
    background: #eca6e7;
    width: 13px;
    border: solid #ce62ca;
    border-width: 1px 2px 2px 1px;
    border-radius: 6px 0 0 0;
    height: 13px;
    display: inline-block;
    margin-right: 4px;
}
#custom div:hover, #custom div:focus {
    border: 1px #7bcdf5 solid;
    background: #ceefff;
}
img {
    height: 46px;
}
    </style>
</head>
<body>
    <div id="custom" class="custom"></div>
    <script>
    var types = ['jpg', 'jpeg', 'gif', 'png'];
    var clickTime = new Date();
    var clickF = '';
    var root = document.getElementById("custom");
    var base = '/Picture/nogizaka/image';
    function show() {
        let path = '';
        let index = window.location.href.indexOf('#');
        if (index != -1) {
            path = decodeURI(window.location.href.substring(index+1));
        } else {
            window.location.href = '#';
        }
        let target;
        if (path) {
            let dirNames = path.split('/');
            for (let i=1; i<dirNames.length; i++) {
                target = target?target.child[dirNames[i]] : dir.child[dirNames[i]];
            }
        } else {
            target = dir;
        }
        root.innerHTML = '';
        for (let file in target.child) {
            let div = document.createElement("div");
            div.innerHTML = file;
            div.setAttribute('tabindex', '0');
            if (target.child[file].dir) {
                div.className="dir";
                div.addEventListener('click', function(e){
                    let now = new Date();
                    let cost = now - clickTime;
                    if (clickF == file && cost<500) {
                        window.location.href += '/' + file;
                        show();
                    }
                    clickF = file;
                    clickTime = now;
                });
            } else {
                div.className="file";
                let url = base + path + '/' + file;
                let type = file.substring(file.indexOf('.')+1).toLowerCase();
                if (types.indexOf(type) != -1) {
                    div.innerHTML = '<img src="' + url + '"/>' + file;
                }
                //div.style.backgroundImage = "url('"+url+"')";
                div.addEventListener('click', function(e){
                    let now = new Date();
                    let cost = now - clickTime;
                    if (clickF == file && cost<500) {
                        window.open(url);
                    }
                    clickF = file;
                    clickTime = now;
                });
            }
            root.appendChild(div);
        }
    }
    
    show();
    window.onpopstate = function(){
        show();
    };

    </script>
</body>
</html>
